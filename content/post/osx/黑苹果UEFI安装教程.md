---
title: "黑苹果UEFI安装教程"
date: 2014-12-25T17:43:52+08:00
tags: ["hackintosh", "UEFI"]
categories: ["OSX"]
toc: true
---

## 导言:
其实如果你只想装一个黑苹果而不要求完美驱动的话,其安装还是很简单的.当然,你得有合适的硬件(一般主流intel平台都能装,amd的你就折腾吧),如果想省事的话那就看这里的[硬件购买推荐](http://www.tonymacx86.com/446-building-customac-buyer-s-guide-october-2014.html).

我买电脑的时候没想过要折腾黑苹果,但还是主流intel+nvidida平台,所以只能悲催地介绍下我的主板及bios,显卡一般nvidia的免驱.AMD的由于没有硬件,所以并不清楚.

## 主板:
首先介绍下主板：七彩虹C.P67H V20.  芯片组是H67，BIOS是AMI BIOS。带有一个usb3.0接口,声卡ALC662.特别要注意的是
1. 开启硬盘的AHCI模式,别用IDE或compatible模式了.AHCI证明读写更快.
2. 关闭USB3.0. 目前USB3.0问题多多.
4. 尽量有USB键鼠
5. 如果对bios熟悉,把bios里一些特殊功能关掉

我们的目标是能装上黑苹果,所以原则上尽量把要驱动的设备(如usb3.0,蓝牙,触摸板等特殊设备禁用),只保留必要的设备(显卡,键鼠,声卡).

* 显卡一般会免驱,而且禁用后还有CPU的集显. 当然出现显卡出现问题的话还是可以禁用的.
* 键鼠如果不是USB的一定要记得打上PS2补丁.
* 声卡一般不会导致五国,最多不出声而已,所以开着吧.

## UEFI:
我的主板兼容UEFI和PI引导，但是它不是AMI的EFI主板。可以通过官方的两款BIOS升级工具查知。其特点是除了在CMOS信息栏中看到它兼容UEFI，但是其它栏中根本没有EFI的设置选项，安装win7后BIOS引导菜单多出windows boot manager。

这里我们说下uefi引导的相关知识:
以前的分区知识告诉你,一块硬盘只能有1个mbr和4个主分区,主分区可以是扩展分区,然后这个扩展分区可以划分很多个逻辑分区.嗯,没错,这就是MBR分区表(引导),引导流程从bios->mbr->引导程序->PBR->分区引导程序->加载系统.

现在有人说现在是21世纪了,只能有4个主分区?能更人性化点么?于是就有了UEFI引导,对应的分区格式为GPT.
它的默认引导流程(64位)是:
`bios->EFI/boot/bootx64.efi->引导程序(如clover)->xxx.efi(如bootmgfw.efi)->加载系统`

clover安装后的bootx64.efi其实就是cloverx64.efi,重命名罢了.

如果你指定bios引导某个efi,可通过bcfg设定,就是不走默认引导流程,参考[兼容UEFI2.3主板添加主板引导项](http://mlyixi.byethost32.com/blog/?p=23)

这里我们就要按bios的不同介绍安装黑苹果的两种类型:

* 只支持mbr引导的推荐使用变色龙引导(当然你也可以使用clover,走`bios->mbr->efi`线,但是比较慢,不推荐)
* 支持(兼容)uefi引导的推荐使用clover引导(更接近原生,走`bios->efi`线)

像我2011年配的机子都支持uefi引导了,现在基本都是uefi主板了吧.不是的就别看了,去参考变色龙引导吧.

## 准备安装介质
安装介质有两种:懒人版和原版.

* 懒人版是别人制作,集成了作者认为需要的补丁及优化,可以方便的安装.缺点是你不知道作者改了些什么,如果出现问题,你根本无法判断哪里出了问题,也不推荐拿到论坛里问人,因为不具参考性,同时不太稳定,升级下系统之类的就可能五国了
* 原版的就是一个纯净的系统,给白苹果用的.但是因为是黑苹果,我们要根据自己硬件的不同打打补丁.就现在的我而言,原版安装比懒人版更快.其优点是稳定性较高,易控,但是操作要求高.

那么问题来了,我们怎么选择安装介质呢?这里的推荐是:

* 如果你是初学者且手头没有苹果系统,推荐先用懒人版.因为方便在win下制作,而且如果你按上面的原则做了,总能找到一款合适你的懒人版的.
* 如果手头有苹果系统或有相应知识,那么就推荐用原版介质.因为安装介质的制作相对简单且易控制.

下面说明原版介质的制作:

1.    准备一个大于8G的U盘(6G够了)
2.    用硬盘格式格式化成GUID分区表和MacOS 扩展(日志式)文件系统.
3.    将下载的原版dmg/app/iso挂载
4.    进入/Contents/Resources中复制出createinstallmedia到桌面
5.    运行命令`/Users/UserName/Desktop/createinstallmedia --volume /Volumes/UDiskName --applicationpath /user/UserName/Desktop/InstallAppName.app`
6.    确认(Y)并等待制作完成.

至此,安装介质制作好了.

## 准备引导程序
如果硬盘上没有clover,你现在是没有引导程序的.所以我们得把clover`安装`到U盘里,这里所谓的`安装`其实就是把需要的文件放到EFI分区.
### 安装
由于我们走bios->uefi线,所以推荐用clover的pkg包或USBTools.注意,其中用原版pkg安装的话要自定义安装clover到EFI分区,不勾选boot0af,boot0ss等bios->mbr->uefi线引导相关文件,当然你也可以把之前的clover复制过来(如果你有的话).
### 配置
接下来就是clover的配置文件,一般我们可以保持默认.
### 打补丁
放入必要的kext(fakesmc.kext)到clover对应的文件夹中(EFI/Clover/kexts/10.10/).
### 配置clover(config.plist)
这时一般保持默认,只要修改一些必要的引导参数,如Boot/Arguments的Verbose,供找错误使用.

这样,我们的安装介质就准备好了.其实这就是一个简单的黑苹果了(你可以想像成windows的winpe).而我们要把安装黑苹果到硬盘,其实就是把上面的步骤再重新走一遍,只不过要考虑的东西更多更详细些罢了.

## 准备硬盘安装
### 硬盘分区
当然得是GPT分区表了.一般电脑都会安装个双系统或三系统,这时你得有个安装顺序,甚至要选择用什么工具分:windows的diskpart?苹果的磁盘助手?Linux的XXX?

其实各工具都差不多,看自己对哪个熟悉了.注意点有:
1. 苹果要求efi分区要200M以上,不然苹果安装不上的.
2. Win要求有个MSR分区,如果安装的时候没有事先建立则会自建一个.为了保证分区表的美观--其实也没什么,你自己决定了;可以将分区表作如此安排:EFI-OSX-WIN7-...
3. 除EFI和OSX区,其它的分区可以先不作划分,到时按需划分.

### 安装苹果
1. 插上U盘,修改bios引导项或开机按快捷引导键,选择`EFI U盘名`引导进入clover.
2. 选择制作的安装介质引导
3. 看看详细的log信息(verbose模式),如有卡住,查看有没有注入kext,卡住的信息.
4. 如果有注入kext但卡住,去论坛或搜索相关信息.

### 安装引导
现在的苹果系统还是没有引导的(引导程序还在你的U盘上,你可以开机进入U盘的clover).这时你需要把u盘上的clover和boot复制到你硬盘的EFI分区里. 这样引导时就默认引导clover了. 想修改bios默认引导项参考[兼容UEFI2.3主板添加主板引导项](http://mlyixi.byethost32.com/blog/?p=23)

### 打补丁
然后你就尝试一点一点把之前在bios中禁用的设备启用,看能不能免驱,不能免驱就去搜索打上补丁吧.
1.    用kext打补丁
	注意:打完补丁后记得用最新版kext utility修复权限. 10.9以后kext都有签名认证,不修复不加载SLE下的kext.用pkg安装驱动文件后最好也修复下权限.
2.    用clover配置文件打补丁
	具体可参见config配置文件说明和clover configurator